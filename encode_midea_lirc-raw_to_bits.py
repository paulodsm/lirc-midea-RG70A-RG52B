# -*- coding: utf-8 -*- 
#
# Python script that decodes **Midea Signals** (Pulses and Spaces) from mode2 lirc into 24-bit data
#
# Capturing on lirc: stop lirc service (#/etc/init.d/lircd stop); run mode2 capture (#mode2 -d /dev/lirc0 -m > filename.raw); press a SINGLE desired funcion on remote pointing to IR receiver, then stop the capture
#
# from filename.raw, remove header (3 first lines, including the first big number)
# 
# Remaining numbers are alternated Pulses and Spaces periods in Microsseconds, they need to be reorganized to have a single space between them, on the same line
# 
# Generated output from this code is a 24bit data that Midea RC use.
# 
# See PNG file for pulses interpretation details
#

import sys

raw_dict={}


#add to raw_dict signals read from mode2 in lirc

raw_dict['off']='4402 4392 537 1643 537 561 532 1648 536 1643 536 558 536 558 536 1643 537 559 536 559 537 1647 537 558 536 559 534 1644 536 1643 537 558 542 1643 536 560 536 1643 536 1643 536 1643 537 1643 544 550 535 1647 537 1644 537 1649 536 557 536 558 536 557 536 557 536 1643 537 559 534 559 536 1649 536 1643 536 1643 536 558 535 558 536 557 536 557 536 559 536 559 537 556 537 557 536 1647 536 1644 535 1642 537 1643 535 1645 534 5251 4386 4390 536 1643 536 565 528 1646 537 1642 536 558 536 557 536 1644 535 559 536 559 536 1647 536 557 536 558 535 1643 543 1636 536 557 537 1648 535 559 537 1643 536 1643 536 1642 537 1642 537 557 536 1646 537 1645 535 1649 536 557 540 553 537 557 535 557 536 1642 536 558 535 560 536 1649 535 1643 537 1642 536 557 536 557 539 555 535 557 536 560 535 559 537 557 535 557 536 1647 536 1643 536 1642 536 1644 535 1645 535'

raw_dict['S.on-M.cool-F.low-T.25']='4384 4383 537 1640 540 554 538 1643 538 1642 536 556 537 555 537 1641 537 558 539 555 538 1644 538 556 535 556 538 1640 537 1641 538 559 534 1645 537 1647 538 555 534 558 538 1640 537 1640 537 1641 538 1640 537 1643 542 552 539 1639 537 1641 538 556 535 557 536 556 537 556 537 557 537 1643 537 1640 538 555 536 557 538 555 537 556 536 556 537 557 537 558 537 554 538 1644 536 1642 536 1641 538 1640 537 1641 537 1641 538 5218 4387 4383 540 1639 536 556 537 1645 535 1644 535 556 536 557 536 1641 538 556 535 560 536 1645 536 557 536 555 537 1640 538 1640 536 557 535 1647 536 1648 535 557 537 555 537 1640 536 1641 536 1642 537 1641 536 1643 536 558 537 1640 538 1640 535 559 536 555 536 556 536 557 536 560 535 1642 537 1640 537 556 537 554 537 556 537 556 536 556 538 556 537 557 537 556 536 1644 537 1641 535 1641 537 1640 538 1640 536 1643 537'

raw_dict['silent']='4421 4421 553 1658 553 553 553 1658 553 1658 553 553 553 1658 553 553 553 1658 553 553 553 1658 553 553 553 553 553 1658 553 553 553 1658 553 553 553 1658 553 1658 553 1658 553 1658 553 553 553 1658 553 553 553 1658 553 553 553 553 553 553 553 553 553 1658 553 553 553 1658 553 553 553 1658 553 553 553 553 553 553 553 553 553 1658 553 1658 553 553 553 553 553 1658 553 1658 553 1658 553 1658 553 553 553 553 553 1658 553 5220 4421 4421 553 1658 553 553 553 1658 553 1658 553 553 553 1658 553 553 553 1658 553 553 553 1658 553 553 553 553 553 1658 553 553 553 1658 553 553 553 1658 553 1658 553 1658 553 1658 553 553 553 1658 553 553 553 1577 553 553 553 553 553 553 553 553 553 1658 553 553 553 1658 553 553 553 1578 553 553 553 553 553 553 553 553 553 1658 553 1658 553 553 553 553 553 1576 553 1658 553 1658 553 1658 553 553 553 553 553 1658 553'


for k in raw_dict:


	pulses=[]
	for j in raw_dict[k].split(' '):
		pulses.append(int(j))	


	#normalizando os pulsos
	i=0
	while i <= (len(pulses)-1):
		if pulses[i]>4370 and pulses[i]<4470:
			pulses[i]=4421
		if pulses[i]>500 and pulses[i]<600:
			pulses[i]=553
		if pulses[i]>1600 and pulses[i]<1700:
			pulses[i]=1658
		if pulses[i]>5170 and pulses[i]<5270:
			pulses[i]=5220
		
		i+=1

	#print(pulses)

	#sys.exit(1)

	bits=''
	i=3
	while len(bits) < 24:
		if pulses[i-1]==553 and pulses[i]==553:
			bits=bits+'0'
		if pulses[i-1]==553 and pulses[i]==1658:
			bits=bits+'1'
		
		i+=2 #skip 2 pulses
		
		if len(bits)==8: #if 1 byte is done, skip next byte due to inverted byte on line code
			i+=16
		if len(bits)==16: #if 1 more byte is done, skip next byte due to inverted byte on line code
			i+=16

	
	print (k+'\n'+bits+'\n')
	#print(pulses)

#sys.exit(1)

		
		
